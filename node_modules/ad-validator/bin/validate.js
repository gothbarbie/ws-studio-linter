#!/usr/bin/env node
const help = {
	'-h': true, '-help': true, '--help': true
};

const spaces = '   ';

if ( process.argv[ 2 ] in help ) {
	console.log( 'Usage: validate-ad [ filename ]' );
	console.log();
	console.log( 'If no filename is specified, it will read from stdin.' );
	process.exit( 0 );
}

const fs = require( 'fs' );
const i = require( 'i' )();
const validate = require( '../' );

const html = fs.readFileSync( process.argv[ 2 ]Â || 0, 'utf8' );

const errors = validate.html( html );

function pluralize( num, str ) {
	return num > 1 ? i.pluralize( str ) : str;
}

function pad3( str ) {
	str = String( str );

	if ( str.length >= 3 ) return;

	return spaces.slice( 0, 3 - str.length ) + str;
};

function printError( error ) {
	console.error( `(${ pad3( error.start.line ) }:${ pad3( error.start.column ) }): ${ error.message }`);
}

if ( !errors.length ) {
	console.log( 'The html is ok.' );
} else {
	console.error( `Found ${ errors.length } ${ pluralize( errors.length, 'error' ) }:` );
}

errors.sort( validate.compareErrors ).forEach( printError );
