<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Ad Validator</title>

		<link rel="stylesheet" href="https://common-ui.widespace.com/css/ws-bootstrap.css" media="screen" charset="utf-8">
		<style media="screen">
			nav.navbar {
				border-radius: 0;
			}

			h1 {
				font-size: medium;
				color: white;
				line-height: 50px;
				margin: 0;
			}

			h1 span {
				font-weight: bold;
				text-transform: uppercase;
				border-left: 1px solid white;
				padding-left: 0.5em;
			}

			sup.version {
				font-family: serif;
				font-style: italic;
				padding-left: 0.1em;
			}

			html, body {
				height: 100%;
			}

			main {
				padding: 0 2em;
				height: calc( 100% - 73px ); /* TODO: make this better */
			}

			div.CodeMirror {
				border: 1px solid #ddd;
				height: 70%; /* TODO: make this better */
			}
		</style>
	</head>
	<body>
		<nav class="navbar navbar-default">
			<a class="navbar-brand"></a>
			<h1>
				<span>
				Ad Validator
				</span>
				<sup class="version">alpha</sup>
			</h1>
		</nav>

		<main>
			<h2>Paste HTML</h2>
			<p>Errors: <span id="error-count"></span></p>
			<textarea placeholder="Paste HTML here..." style="width: 100%; height: 100%;"></textarea>
		</main>

		<!-- import CodeMirror -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/codemirror.min.css">

		<!-- linting -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/addon/lint/lint.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/addon/lint/lint.min.css">

		<!-- import required syntax modes -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/xml/xml.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/javascript/javascript.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/css/css.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.11.0/mode/htmlmixed/htmlmixed.min.js"></script>

		<script src="./validate.js"></script>
		<script>
			// Expose the ad-validator as an HTML-linter.
			CodeMirror.registerHelper( 'lint', 'html', function (text, options) {
				var found = [];

				var messages = validate.html( text );

				document.getElementById( 'error-count' ).innerText = messages.length;

				messages.forEach( message => {
					found.push({
						from: CodeMirror.Pos( message.start.line, message.start.column ),
						to: CodeMirror.Pos( message.end.line, message.end.column ),
						message: message.message,
						severity: 'error'
					});
				});

				return found;
			});

			var html = CodeMirror.fromTextArea( document.querySelector( 'textarea' ), {
				lineNumbers: true,
				mode: 'text/html',
    		gutters: [ 'CodeMirror-lint-markers' ],
				lint: true
			});
		</script>
	</body>
</html>
