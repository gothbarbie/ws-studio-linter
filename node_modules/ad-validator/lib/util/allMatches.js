const Pos = require( '../position.js' );

module.exports = function allMatches ( regex, text, position, fn ) {
	allRaw( regex, text ).reduce( ( start, match ) => {
		start = Pos.move( start, text.slice( start.index, match.index ) );
		const end = Pos.move( start, match[0].length );

		fn( match, start, end );

		return end;
	}, position );
}


function allRaw( regex, string ) {
	if ( !regex.global ) throw new TypeError( `regex must be global!` );

	var match, matches = [];

	while ( match = regex.exec( string ) ) {
		matches.push( match );
	}

	return matches;
};
